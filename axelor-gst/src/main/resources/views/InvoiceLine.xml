<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<object-views xmlns="http://axelor.com/xml/ns/object-views"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://axelor.com/xml/ns/object-views http://axelor.com/xml/ns/object-views/object-views_5.1.xsd">

    <grid name="invoice-line-grid" title="Invoice lines"
        model="com.axelor.apps.account.db.InvoiceLine" id="invoice-line-grid-with-gstrequirements">
        <hilite strong="true" color="default" if="typeSelect != 0" />
        <field name="product.code" width="120" />
        <field name="productName" />
        <field name="qty" aggregate="sum" />
        <field name="priceDiscounted" title="Unit price W.T." x-scale="2" />
        <field name="inTaxPrice" x-scale="2" />
        <field name="unit" form-view="unit-form" grid-view="unit-grid" />
        <field name="exTaxTotal" aggregate="sum" />
        <field name="inTaxTotal" aggregate="sum" />
        <!-- Adding GstRate and other GSTs -->
        <field name="gstRate" if="__config__.app.isApp('gst')" if-module="axelor-gst" />
        <field name="igst" if="__config__.app.isApp('gst')" if-module="axelor-gst" />
        <field name="cgst" if="__config__.app.isApp('gst')" if-module="axelor-gst" />
        <field name="sgst" if="__config__.app.isApp('gst')" if-module="axelor-gst" />
        <!-- Adding GstRate and other GSTs -->
        <field name="typeSelect" hidden="true" />
    </grid>

    <grid name="invoice-line-menu-grid" title="Invoice lines"
        model="com.axelor.apps.account.db.InvoiceLine" canNew="false" canEdit="false"
        canSave="false" canDelete="false" canArchive="false" edit-icon="true"
        orderBy="-invoice.invoiceDate" id="invoice-line-menu-grid-with-gstrequirements">
        <hilite color="primary" if="$get('invoice.statusSelect') == 1" />
        <hilite color="danger"
            if="$get('invoice.statusSelect') == 3 &amp;&amp; $get('invoice.amountRemaining') &gt; 0 &amp;&amp; $moment($get('invoice.dueDate')).diff(todayDate,'days') &lt; 0" />
        <hilite color="warning"
            if="$get('invoice.statusSelect') == 3 &amp;&amp; $get('invoice.amountRemaining') &gt; 0 &amp;&amp; $moment($get('invoice.dueDate')).diff(todayDate,'days') &gt;= 0 &amp;&amp; $moment($get('invoice.dueDate')).diff(todayDate,'days') &lt;= 5" />
        <hilite color="success"
            if="$get('invoice.statusSelect') == 3 &amp;&amp; $get('invoice.amountRemaining') == 0" />
        <field name="invoice.partner.partnerSeq" width="120" title="Partner code" />
        <field name="invoice.partner.simpleFullName" title="Partner" />
        <field name="invoice.invoiceId" width="120" />
        <field name="invoice.invoiceDate" title="Date" />
        <field name="invoice.statusSelect" title="invoiceLineMenu.status" />
        <field name="invoice.address.addressL7Country" />
        <field name="product.code" title="product.code" width="120" />
        <field name="productName" width="170" />
        <field name="qty" width="50" aggregate="sum" />
        <field name="priceDiscounted" title="Unit price W.T." x-scale="2" />
        <field name="unit" width="60" form-view="unit-form" grid-view="unit-grid" />
        <field name="exTaxTotal" aggregate="sum" />
        <!-- Adding GstRate and other GSTs -->
        <field name="gstRate" if="__config__.app.isApp('gst')" if-module="axelor-gst" />
        <field name="igst" if="__config__.app.isApp('gst')" if-module="axelor-gst" />
        <field name="cgst" if="__config__.app.isApp('gst')" if-module="axelor-gst" />
        <field name="sgst" if="__config__.app.isApp('gst')" if-module="axelor-gst" />
        <!-- Adding GstRate and other GSTs -->
        <field name="invoice.currency" width="85" />
        <field name="companyExTaxTotal" title="WT amount in company currency" aggregate="sum"
            hidden="false" />
        <field name="invoice.company.currency" title="Company currency" width="125" />
        <field name="invoice.amountRemaining" hidden="true" />
        <field name="invoice.dueDate" hidden="true" />
    </grid>

    <form name="invoice-line-form" title="Invoice line"
        model="com.axelor.apps.account.db.InvoiceLine" width="large" readonlyIf="$isReadOnly"
        onNew="action-account-invoice-line-onnew-group"
        onLoad="action-group-account-invoice-line-onload"
        id="invoice-line-form-with-gstrequirements">
        <panel name="titlePanel" hideIf="typeSelect != 1">
            <field name="productName" title="Title" requiredIf="typeSelect == 1" colSpan="9" />
            <field name="typeSelect" colSpan="3"
                onChange="action-invoice-line-method-empty-line" selection-in="[0,1]" />
        </panel>
        <panel-tabs name="mainPanelTab" hideIf="typeSelect == 1">
            <panel name="informationsPanel" title="Information">
                <field name="product" canEdit="false"
                    onChange="action-group-account-invoice-line-product-onchange"
                    onSelect="action-invoice-line-attrs-set-product-domain-onselect"
                    form-view="product-form" grid-view="product-grid" />
                <!-- HSBN -->
                <field name="hsbn" />
                <!-- HSBN -->
                <field name="$isFilterOnSupplier" title="Filter on supplier" type="boolean"
                    widget="boolean-switch" colSpan="2"
                    if="__config__.app.isApp('purchase') &amp;&amp; __config__.app.getApp('purchase').getManageSupplierCatalog()" />
                <field name="typeSelect" colSpan="3"
                    onChange="action-invoice-line-method-empty-line" selection-in="[0,1]" />
                <field name="packPriceSelect" colSpan="3" showIf="typeSelect == 2"
                    onChange="action-group-invoice-line-pack-price-select-onchange"
                    if="(__config__.app.isApp('sale') &amp;&amp; __config__.app.getApp('sale').getProductPackMgt())" />
                <field name="productName" colSpan="12" requiredIf="typeSelect != 1" />
                <field name="qty" colSpan="3" required="true" readonlyIf="isSubLine"
                    onChange="action-group-account-invoice-line-qty-onchange" />
                <field name="unit" colSpan="3" canEdit="false" form-view="unit-form"
                    grid-view="unit-grid" readonlyIf="typeSelect == 2 || isSubLine" />
                <field name="price" colSpan="3" required="true"
                    onChange="action-invoice-line-method-onchange-price,action-invoice-line-method-compute,action-invoice-line-method-compute-analytic-distribution,action-budget-validate-exceed-line-amount"
                    hidden="true" />
                <field name="inTaxPrice" colSpan="3" required="true"
                    onChange="action-invoice-line-method-onchange-intaxprice,action-invoice-line-method-compute,action-invoice-line-method-compute-analytic-distribution,action-budget-validate-exceed-line-amount"
                    hidden="true" />
                <panel name="discountPanel" colSpan="12">
                    <field name="discountTypeSelect" colSpan="3"
                        onChange="action-invoice-line-method-compute,action-invoice-line-attrs-discountamount-title,action-invoice-line-method-compute-analytic-distribution,action-budget-validate-exceed-line-amount" />
                    <field name="discountAmount" colSpan="3"
                        onChange="action-invoice-line-method-compute,action-invoice-line-method-compute-analytic-distribution,action-budget-validate-exceed-line-amount"
                        hideIf="discountTypeSelect == 3" />
                    <field name="priceDiscounted" colSpan="3" hidden="true" readonly="true" />
                </panel>
                <field name="taxLine" canEdit="false"
                    onChange="action-invoice-line-method-convert-tax,action-invoice-line-method-compute,action-invoice-line-method-compute-analytic-distribution,action-budget-validate-exceed-line-amount"
                    grid-view="tax-line-grid" form-view="tax-line-form" />
                <field name="exTaxTotal" colSpan="3" readonly="true" />
                <field name="inTaxTotal" colSpan="3" readonly="true" />
                <field name="isSubLine" hideIf="!isSubLine"
                    if="(__config__.app.isApp('sale') &amp;&amp; __config__.app.getApp('sale').getProductPackMgt())"
                    colSpan="4" />
                <field name="parentLine" hideIf="!isSubLine || parentLine == null" />
                <field name="$isReadOnly" hidden="true" />
                <field name="taxEquiv" hidden="true" grid-view="tax-equiv-grid"
                    form-view="tax-equiv-form" />
                <field name="invoice" hidden="true" />
                <field name="companyExTaxTotal" hidden="true" />
                <field name="companyInTaxTotal" hidden="true" />
                <!-- GstRate and GSTs -->
                <panel title="Other Taxes" if="__config__.app.isApp('gst')"
                    showIf="product != null" if-module="axelor-gst">
                    <field name="gstRate" colSpan="3" readonly="true" />
                    <field name="igst" colSpan="3" readonly="true" />
                    <field name="cgst" colSpan="3" readonly="true" />
                    <field name="sgst" colSpan="3" readonly="true" />
                </panel>
                <!-- GstRate and GSTs -->
                <panel name="descriptionPanel" title="Description" colSpan="12">
                    <field name="description" showTitle="false" colSpan="12" widget="html"
                        x-lite="true" />
                </panel>
            </panel>
            <panel name="packPanel" title="Pack lines" showIf="typeSelect == 2"
                readonlyIf="packPriceSelect == 0">
                <panel-related name="subLineListPanel" field="subLineList"
                    onChange="action-invoice-line-attrs-compute-total-pack" colSpan="12"
                    canNew="false" canRemove="false" form-view="invoice-line-form"
                    grid-view="invoice-line-grid" />
                <field name="totalPack" readonly="true" />
            </panel>
            <panel name="accountingPanel" title="Accounting">
                <field name="account" colSpan="9"
                    onSelect="action-invoice-line-method-filter-account" canEdit="false" />
                <panel name="assetsPanel" colSpan="3" itemSpan="12">
                    <field name="fixedAssets" showTitle="false" showIf="$readonly()">
                        <viewer depends="fixedAssets">
							<![CDATA[
								<span class="label label-default" style="background-color: #B6473F; margin: 10px 0 !important; padding: 5px 0 !important; display: inline-table; line-height: initial;" ng-show="record.fixedAssets" x-translate>Fixed Assets</span>
							]]>
						</viewer>
                    </field>
                    <field name="fixedAssets" showTitle="true"
                        hideIf="$readonly() || $contains([3,4], $_operationTypeSelect)"
                        widget="boolean-switch" onChange="action-invoice-line-method-get-account" />
                    <field name="$_operationTypeSelect" hidden="true" />
                    <field name="$_company" type="many-to-one"
                        target="com.axelor.apps.base.db.Company" hidden="true" />
                    <field name="fixedAssetCategory" canEdit="false"
                        domain="self.company = :_company" form-view="fixed-asset-category-form"
                        grid-view="fixed-asset-category-grid"
                        showIf="fixedAssets &amp;&amp; $contains([1,2], $_operationTypeSelect)" />
                </panel>
            </panel>

            <panel name="budgetPanel" title="Budget" if="__config__.app.isApp('budget')">
                <field name="companyExTaxTotal" title="Total W.T." colSpan="6"
                    if="__config__.app.getApp('budget').getManageMultiBudget()" readonly="true"
                    hidden="false">
                    <viewer depends="companyExTaxTotal,$currencySymbol">
						<![CDATA[
							<dd>{{record.companyExTaxTotal}} {{record.$currencySymbol}}</dd>
						]]>
					</viewer>
                </field>
                <field name="budgetDistributionSumAmount" colSpan="6"
                    if="__config__.app.getApp('budget').getManageMultiBudget()" readonly="true" />
                <field name="budget"
                    if="!__config__.app.getApp('budget').getManageMultiBudget()" canEdit="false"
                    domain="self.statusSelect = 2" />
                <panel-related name="budgetDistributionListPanel"
                    field="budgetDistributionList" editable="true" colSpan="12"
                    if="__config__.app.getApp('budget').getManageMultiBudget()"
                    onChange="action-budget-validate-exceed-line-amount,action-invoice-order-method-compute-budget-distribution-sum-amount" />
                <field name="$currencySymbol" hidden="true" />
            </panel>
            <panel name="projectPanel"
                if="__config__.app.isApp('business-project') &amp;&amp; __config__.app.getApp('business-project').getProjectInvoiceLines()"
                title="Business Project" if-module="axelor-business-project">
                <field name="project" canEdit="false"
                    onSelect="action-invoice-line-attrs-domain-project" form-view="project-form"
                    grid-view="project-grid" />
                <panel-dashlet name="teamTaskListPanel" title="Related tasks"
                    action="action-invoice-line-view-team-tasks" colSpan="12" />
            </panel>
            <panel name="analyticDistributionPanel" title="Analytics"
                if-module="axelor-supplychain"
                if="__config__.app.isApp('account') &amp;&amp; __config__.app.getApp('account').getManageAnalyticAccounting()"
                onTabSelect="action-invoice-line-attrs-read-only-distribution-lines">
                <field name="analyticDistributionTemplate"
                    readonlyIf="!account.analyticDistributionAuthorized"
                    grid-view="analytic-distribution-template-grid"
                    form-view="analytic-distribution-template-form" canEdit="false"
                    onChange="action-invoice-line-method-create-distribution"
                    onSelect="action-invoice-line-attrs-set-domain-analytic-distribution-template" />
                <panel-related name="analyticMoveLineListPanel"
                    field="analyticMoveLineList" grid-view="analytic-move-line-distribution-grid"
                    form-view="analytic-move-line-distribution-form" colSpan="12"
                    onChange="action-attrs-account-invoice-line-onnew-onload" />
                <field name="account.analyticDistributionAuthorized" hidden="true" />
            </panel>
            <panel name="configurationPanel" title="Configuration"
                if-module="axelor-supplychain" if="__config__.app.isApp('supplychain')">

                <field name="saleOrderLine" if="__config__.app.isApp('supplychain')"
                    if-module="axelor-supplychain" form-view="sale-order-line-invoice-form"
                    grid-view="sale-order-line-invoice-grid"
                    domain="(self.saleOrder.statusSelect = 3 OR self.saleOrder.statusSelect = 4 ) AND EXISTS(SELECT i FROM Invoice i WHERE i = :invoice AND self.saleOrder.clientPartner = i.partner )" />
                <field name="purchaseOrderLine" if-module="axelor-supplychain"
                    if="__config__.app.isApp('supplychain')" form-view="purchase-order-line-form"
                    grid-view="purchase-order-line-grid" />

            </panel>
        </panel-tabs>
    </form>

    <form name="invoice-line-client-form" title="Invoice line"
        model="com.axelor.apps.account.db.InvoiceLine" width="large"
        onNew="action-account-invoice-line-onnew-group"
        onLoad="action-attrs-account-invoice-line-onnew-onload,action-invoice-line-attrs-readonly-form"
        id="invoice-line-client-form-with-gstrequirements">
        <panel name="titlePanel">
            <field name="typeSelect" onChange="action-invoice-line-method-empty-line" />
            <field name="productName" showIf="typeSelect == 1" title="Title"
                requiredIf="typeSelect == 1" />
        </panel>
        <panel-tabs name="mainPanelTab" hideIf="typeSelect == 1">
            <panel name="informationsPanel" title="Informations">
                <field name="product"
                    onChange="action-group-account-invoice-line-product-onchange"
                    form-view="product-form" grid-view="product-grid" canView="false" />
                <!-- HSBN -->
                <field name="hsbn" />
                <!-- HSBN -->
                <field name="productName" requiredIf="!typeSelect == 1" />
                <field name="qty" required="true"
                    onChange="action-group-account-invoice-line-qty-onchange" />
                <field name="price" required="true"
                    onChange="action-invoice-line-method-onchange-price,action-invoice-line-method-compute,action-invoice-line-method-compute-analytic-distribution"
                    hidden="true" />
                <field name="inTaxPrice" required="true"
                    onChange="action-invoice-line-method-onchange-intaxprice,action-invoice-line-method-compute,action-invoice-line-method-compute-analytic-distribution"
                    hidden="true" />
                <field name="unit" canEdit="false" form-view="unit-form" grid-view="unit-grid" />
                <field name="priceDiscounted" hidden="true" />
                <field name="taxLine"
                    onChange="action-invoice-line-method-convert-tax,action-invoice-line-method-compute,action-invoice-line-method-compute-analytic-distribution"
                    grid-view="tax-line-grid" form-view="tax-line-form" />
                <field name="exTaxTotal" readonly="true" />
                <field name="inTaxTotal" readonly="true" />
                <field name="invoice" hidden="true" />
                <panel name="discountPanel" title="Discount" colSpan="12">
                    <field name="discountTypeSelect"
                        onChange="action-invoice-line-method-compute,action-invoice-line-attrs-discountamount-title,action-invoice-line-method-compute-analytic-distribution" />
                    <field name="discountAmount"
                        onChange="action-invoice-line-method-compute,action-invoice-line-method-compute-analytic-distribution"
                        hideIf="discountTypeSelect == 3" />
                </panel>
                <!-- GstRate and GSTs -->
                <panel title="Other Taxes" if="__config__.app.isApp('gst')"
                    showIf="product != null &amp;&amp; product.gstRate &gt; 0 "
                    if-module="axelor-gst">
                    <field name="gstRate" colSpan="3" readonly="true" />
                    <field name="igst" colSpan="3" readonly="true" />
                    <field name="cgst" colSpan="3" readonly="true" />
                    <field name="sgst" colSpan="3" readonly="true" />
                </panel>
                <!-- GstRate and GSTs -->
            </panel>
        </panel-tabs>
    </form>
</object-views>
